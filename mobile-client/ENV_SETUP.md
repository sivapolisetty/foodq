# GraBeat Mobile - Environment Setup Guide

## Quick Start Commands

We have created convenient npm scripts to easily switch between local and production environments.

### üì± Development Commands

#### Local API (localhost:8788)
```bash
npm run dev           # Run on default device with local API
npm run dev:ios       # Run on iOS with local API  
npm run dev:android   # Run on Android with local API
```

#### Production API (grabeat-api.pages.dev)
```bash
npm run dev:prod          # Run on default device with production API
npm run dev:prod:ios      # Run on iOS with production API
npm run dev:prod:android  # Run on Android with production API
```

### üîÑ Environment Switching

Switch environments manually:
```bash
npm run env:local   # Switch to local environment
npm run env:prod    # Switch to production environment
```

### üèóÔ∏è Build Commands

```bash
npm run build:ios      # Build iOS release with production API
npm run build:android  # Build Android release with production API
npm run deploy:ios     # Build and deploy iOS to TestFlight
```

### üßπ Utility Commands

```bash
npm run clean    # Clean Flutter build artifacts
npm run pods     # Install iOS CocoaPods dependencies
npm run test     # Run tests
npm run analyze  # Analyze code for issues
npm run format   # Format code
npm run doctor   # Check Flutter setup
```

## Environment Configuration

### Files:
- `.env.local` - Local development configuration
  - API: `http://localhost:8788`
  - Debug: enabled
  
- `.env.production` - Production configuration
  - API: `https://grabeat-api.pages.dev`
  - Debug: disabled

- `.env` - Active configuration (generated by scripts)

### Current Production API:
```
API_BASE_URL=https://grabeat-api.pages.dev
SUPABASE_URL=https://zobhorsszzthyljriiim.supabase.co
```

## Testing Production API Locally

To test the app with production APIs before deploying:

1. **iOS Simulator:**
   ```bash
   npm run dev:prod:ios
   ```

2. **Physical iPhone (wireless):**
   ```bash
   npm run dev:prod:ios
   ```

3. **Android:**
   ```bash
   npm run dev:prod:android
   ```

## Deploying to TestFlight

1. **Ensure production environment:**
   ```bash
   npm run env:prod
   ```

2. **Build and deploy:**
   ```bash
   npm run deploy:ios
   ```

3. **Or build only:**
   ```bash
   npm run build:ios
   ```
   Then upload manually via Xcode Organizer.

## Troubleshooting

### API Connection Issues
- Verify `.env` file has correct API_BASE_URL
- Check if production API is accessible: `curl https://grabeat-api.pages.dev`
- For local API: ensure `wrangler dev` is running on port 8788

### iOS Specific
- If pods fail: `npm run clean && npm run pods`
- For signing issues: Open Xcode and check signing configuration

### Environment Not Switching
- Manually copy environment file: `cp .env.production .env`
- Restart Flutter: Stop the app and run again

## Important Notes

‚ö†Ô∏è **Never commit `.env` files with sensitive data**
- `.env`, `.env.local`, and `.env.production` are gitignored
- Keep production credentials secure

‚úÖ **Current Status:**
- Build 5 deployed to TestFlight with production API
- Production API URL: `https://grabeat-api.pages.dev`
- All privacy permissions configured